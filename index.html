<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>GPT Image OCR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Esconder o input file padrão */
        #images {
            display: none;
        }
    </style>
</head>

<body
    class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-orange-400 via-orange-500 to-orange-600 text-white">

    <div class="w-full max-w-lg bg-white shadow-lg rounded-xl p-6 text-gray-900">

        <h2 class="text-2xl font-bold mb-4 text-center text-orange-700">GPT Image OCR / Description</h2>

        <label class="block font-medium mb-1">API Key:</label>
        <input type="password" id="apiKey" placeholder="sk-..."
            class="w-full border border-orange-400 rounded p-2 mb-3 focus:ring focus:ring-orange-300 focus:border-orange-500 text-sm sm:text-base transition" />

        <label class="block font-medium mb-1">Modelo:</label>
        <select id="model"
            class="w-full border border-orange-400 rounded p-2 mb-3 focus:ring focus:ring-orange-300 focus:border-orange-500 text-sm sm:text-base transition">
            <option value="gpt-4o-mini">gpt-4o-mini (mais barato)</option>
            <option value="gpt-5-mini">gpt-5-mini (novo e barato)</option>
        </select>

        <label class="block font-medium mb-1">Prompt:</label>
        <textarea id="prompt"
            class="w-full border border-orange-400 rounded p-2 mb-3 focus:ring focus:ring-orange-300 focus:border-orange-500 text-sm sm:text-base transition"
            rows="3">Extraia todo o texto dessa imagem e corrija os erros ortográficos e acentuação sem alterar as palavras do texto.</textarea>

        <label for="images"
            class="cursor-pointer inline-flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded shadow transition"
            title="Selecionar imagens">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M5 20h14v-2H5v2zm7-18L5.33 9h3.84v4h4.66v-4h3.84L12 2z" />
            </svg>
            Selecione imagens
        </label>
        <input type="file" id="images" accept="image/*" multiple />
        <div id="fileList" class="mb-4 text-sm text-orange-700">Nenhum arquivo selecionado</div>

        <button id="generateBtn"
            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-4 rounded transition text-sm sm:text-base flex items-center justify-center gap-2 mt-4">
            Generate
            <svg class="w-5 h-5 animate-spin hidden" id="spinner" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
        </button>

        <h3 class="text-lg font-semibold mt-6 text-orange-700">Output:</h3>
        <div id="output"
            class="whitespace-pre-wrap bg-gray-100 p-3 rounded mt-2 text-sm sm:text-base overflow-auto max-h-96 text-gray-900">
        </div>
    </div>


    <footer class="fixed bottom-4 right-4 flex items-center gap-2">
        <button id="heartBtn" aria-label="Informações"
            class="flex items-center justify-center bg-white text-orange-600 font-semibold rounded shadow hover:bg-orange-100 transition select-none"
            style="width: 44px; height: 40px; padding: 0;">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"
                stroke="none">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 
                     7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 
                     19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
            </svg>
        </button>
        <a href="https://www.linkedin.com/in/joaogalves/" target="_blank" rel="noopener noreferrer"
            class="bg-white text-orange-600 font-semibold py-2 px-4 rounded shadow hover:bg-orange-100 transition flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path
                    d="M20.447 20.452H16.9v-5.569c0-1.328-.027-3.038-1.852-3.038-1.853 0-2.135 1.445-2.135 2.939v5.668h-3.547V9h3.408v1.561h.049c.476-.9 1.637-1.852 3.368-1.852 3.602 0 4.268 2.369 4.268 5.455v6.288zM5.337 7.433a2.06 2.06 0 112.06-2.061 2.06 2.06 0 01-2.06 2.06zm1.774 13.019H3.563V9h3.548v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.728v20.542C0 23.226.792 24 1.771 24h20.451c.98 0 1.778-.774 1.778-1.73V1.728C24 .774 23.205 0 22.225 0z" />
            </svg>
            made by JoaoAlves
        </a>
        <div id="infoBox"
            class="pointer-events-none fixed bottom-16 right-4 max-w-xs bg-orange-800 bg-opacity-90 text-white rounded p-4 shadow-lg text-sm opacity-0 translate-y-2 transition-opacity transition-transform duration-300">
            Site feito com amor pensando na Miss Giu, a melhor professor do mundo &lt;3
        </div>
    </footer>

    <script>
        const generateBtn = document.getElementById("generateBtn");
        const spinner = document.getElementById("spinner");
        const outputDiv = document.getElementById("output");
        const imagesInput = document.getElementById("images");
        const fileListDiv = document.getElementById("fileList");

        imagesInput.addEventListener("change", () => {
            const files = imagesInput.files;
            if (files.length === 0) {
                fileListDiv.textContent = "Nenhum arquivo selecionado";
            } else {
                const names = Array.from(files).map(f => f.name);
                fileListDiv.textContent = names.join("\n");
            }
        });

        generateBtn.addEventListener("click", async () => {
            const apiKey = document.getElementById("apiKey").value.trim();
            const model = document.getElementById("model").value;
            const prompt = document.getElementById("prompt").value.trim();
            const files = imagesInput.files;

            if (!apiKey) return alert("Informe sua API key!");
            if (!prompt) return alert("Digite um prompt!");

            outputDiv.textContent = "";
            spinner.classList.remove("hidden");
            generateBtn.disabled = true;

            try {
                if (files.length === 0) {
                    const textResponse = await callGPT(apiKey, model, prompt, null);
                    outputDiv.textContent += `Resposta (${model}):\n${textResponse}\n`;
                } else {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const base64Image = await toBase64(file);
                        outputDiv.textContent += `Processando "${file.name}"...\n`;
                        const textResponse = await callGPT(apiKey, model, prompt, base64Image);
                        outputDiv.textContent += `\nImagem "${file.name}" (${model}):\n${textResponse}\n\n`;
                    }
                }
            } catch (error) {
                outputDiv.textContent += `Erro: ${error.message}`;
            } finally {
                spinner.classList.add("hidden");
                generateBtn.disabled = false;
            }
        });

        async function callGPT(apiKey, model, prompt, base64Image) {
            try {
                const messages = [
                    { role: "user", content: [{ type: "text", text: prompt }] },
                ];
                if (base64Image) {
                    messages[0].content.push({
                        type: "image_url",
                        image_url: { url: `data:image/jpeg;base64,${base64Image}` },
                    });
                }

                const res = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${apiKey}`,
                    },
                    body: JSON.stringify({ model, messages }),
                });

                const data = await res.json();
                return data.choices?.[0]?.message?.content || "Sem resposta.";
            } catch (err) {
                console.error(err);
                return "Erro: " + err.message;
            }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(",")[1]);
                reader.onerror = (error) => reject(error);
            });
        }

        const heartBtn = document.getElementById('heartBtn');
        const infoBox = document.getElementById('infoBox');
        let visible = false;

        heartBtn.addEventListener('click', () => {
            visible = !visible;
            if (visible) {
                infoBox.style.pointerEvents = 'auto';
                infoBox.classList.remove('opacity-0', 'translate-y-2');
                infoBox.classList.add('opacity-100', 'translate-y-0');
            } else {
                infoBox.style.pointerEvents = 'none';
                infoBox.classList.remove('opacity-100', 'translate-y-0');
                infoBox.classList.add('opacity-0', 'translate-y-2');
            }
        });
    </script>
</body>

</html>